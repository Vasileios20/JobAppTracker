{% extends 'base.html' %}
{% load static %}

{% block title %}Your Job Search Journey{% endblock %}

{% block content %}
<div class="stats-container">
    <h1 class="stats-title">Your Job Search Journey</h1>

    <div class="stats-section">
        <h2>Your Current Level</h2>
        <div class="level-card">
            <div class="level-display">
                <span class="level-number">{{ job_seeker_level }}</span>
                <span class="level-title">Code Warrior</span>
            </div>
            <div class="progress-bar">
                <div class="progress" style="width: {% widthratio experience_points next_level_points 100 %}%"></div>
            </div>
            <p>{{ experience_points }} / {{ next_level_points }} XP to next level</p>
        </div>
        <p class="level-explanation">
            Level up by applying to jobs, completing interviews, and achieving milestones in your job search. 
            Higher levels unlock new achievements and quests!
        </p>
    </div>

    <div class="stats-section">
        <h2>Your Job Search Stats</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Applications</h3>
                <div class="stat-circle">
                    <span class="stat-number">{{ total_applications }}</span>
                </div>
            </div>
            <div class="stat-card">
                <h3>Success Rate</h3>
                <div class="stat-circle">
                    <span class="stat-number">{{ success_rate }}%</span>
                </div>
            </div>
            <div class="stat-card">
                <h3>Response Rate</h3>
                <div class="stat-circle">
                    <span class="stat-number">{{ response_rate }}%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-section">
        <h2>Application Insights</h2>
        <div class="chart-grid">
            <div class="chart-card">
                <h3>Application Status</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>Application Trend</h3>
                <canvas id="trendChart"></canvas>
            </div>
        </div>
    </div>

    <div class="stats-section">
        <h2>Your Achievements</h2>
        <p class="achievement-explanation">
            Unlock achievements by reaching milestones in your job search. Each achievement grants XP and helps you level up!
        </p>
        <div class="achievements-grid">
            {% for achievement in achievements %}
            <div class="achievement {% if achievement.unlocked %}unlocked{% endif %}" title="{{ achievement.description }}">
                <i class="fas fa-{{ achievement.icon }}"></i>
                <span>{{ achievement.name }}</span>
                {% if achievement.unlocked %}
                <span class="xp-reward">+{{ achievement.xp }} XP</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="stats-section">
        <h2>Active Quests</h2>
        <p class="quest-explanation">
            Complete quests to earn XP and improve your job search skills. New quests become available as you level up!
        </p>
        <ul class="quest-list">
            {% for quest in active_quests %}
            <li>
                <span class="quest-name">{{ quest.name }}</span>
                <div class="quest-progress-container">
                    <div class="quest-progress" style="width: {{ quest.progress }}%"></div>
                </div>
                <span class="quest-reward">+{{ quest.xp_reward }} XP</span>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
    window.djangoData = {
        statusLabels: [{% for status in status_counts %}'{{ status.status }}',{% endfor %}],
        statusData: [{% for status in status_counts %}{{ status.count }},{% endfor %}],
        trendLabels: [{% for item in trend_data %}'{{ item.date|date:"M d" }}',{% endfor %}],
        trendData: [{% for item in trend_data %}{{ item.count }},{% endfor %}]
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/interactive.js' %}"></script>
{% endblock %}